<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import de.jensd.fx.glyphs.fontawesome.FontAwesomeIconView?>

<ScrollPane xmlns="http://javafx.com/javafx/23"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="ma.ensa.healthcare.ui.controllers.HomeController"
            fitToWidth="true" style="-fx-background-color: transparent;">

    <VBox spacing="30">
        
        <!-- KPI CARDS -->
        <GridPane hgap="20" vgap="20">
            
            <!-- Card 1: Total Patients -->
            <VBox styleClass="card" GridPane.columnIndex="0" GridPane.rowIndex="0" spacing="15" prefWidth="280" prefHeight="140">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane style="-fx-background-color: #E3F2FD; -fx-background-radius: 12; -fx-pref-width: 60; -fx-pref-height: 60;">
                        <FontAwesomeIconView glyphName="USERS" size="30" fill="#2196F3"/>
                    </StackPane>
                    <VBox spacing="5">
                        <Label text="Total Patients" styleClass="card-title"/>
                        <Label fx:id="lblTotalPatients" text="0" styleClass="card-value"/>
                    </VBox>
                </HBox>
                <Label text="↑15% objectif de ce mois" style="-fx-text-fill: #4CAF50; -fx-font-size: 12px;"/>
            </VBox>

            <!-- Card 2: Rendez-vous Aujourd'hui -->
            <VBox styleClass="card" GridPane.columnIndex="1" GridPane.rowIndex="0" spacing="15" prefWidth="280" prefHeight="140">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane style="-fx-background-color: #FFF3E0; -fx-background-radius: 12; -fx-pref-width: 60; -fx-pref-height: 60;">
                        <FontAwesomeIconView glyphName="CALENDAR_CHECK_ALT" size="30" fill="#FF9800"/>
                    </StackPane>
                    <VBox spacing="5">
                        <Label text="RDV Aujourd'hui" styleClass="card-title"/>
                        <Label fx:id="lblRdvToday" text="0" styleClass="card-value"/>
                    </VBox>
                </HBox>
                <Label fx:id="lblRdvTodayDetails" text="5 confirmés, 2 en attente" style="-fx-text-fill: #757575; -fx-font-size: 12px;"/>
            </VBox>

            <!-- Card 3: Consultations ce Mois -->
            <VBox styleClass="card" GridPane.columnIndex="2" GridPane.rowIndex="0" spacing="15" prefWidth="280" prefHeight="140">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane style="-fx-background-color: #E8F5E9; -fx-background-radius: 12; -fx-pref-width: 60; -fx-pref-height: 60;">
                        <FontAwesomeIconView glyphName="STETHOSCOPE" size="30" fill="#4CAF50"/>
                    </StackPane>
                    <VBox spacing="5">
                        <Label text="Consultations" styleClass="card-title"/>
                        <Label fx:id="lblConsultations" text="0" styleClass="card-value"/>
                    </VBox>
                </HBox>
                <Label fx:id="lblConsultationsDetails" text="Ce mois" style="-fx-text-fill: #757575; -fx-font-size: 12px;"/>
            </VBox>

            <!-- Card 4: Revenus du Mois -->
            <VBox styleClass="card" GridPane.columnIndex="3" GridPane.rowIndex="0" spacing="15" prefWidth="280" prefHeight="140">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane style="-fx-background-color: #F3E5F5; -fx-background-radius: 12; -fx-pref-width: 60; -fx-pref-height: 60;">
                        <FontAwesomeIconView glyphName="MONEY" size="30" fill="#9C27B0"/>
                    </StackPane>
                    <VBox spacing="5">
                        <Label text="Revenus" styleClass="card-title"/>
                        <Label fx:id="lblRevenus" text="0 MAD" styleClass="card-value" style="-fx-font-size: 18px;"/>
                    </VBox>
                </HBox>
                <Label fx:id="lblRevenusDetails" text="↑10% objectif de ce mois" style="-fx-text-fill: #4CAF50; -fx-font-size: 12px;"/>
            </VBox>
        </GridPane>

        <!-- SECTION: Rendez-vous Prochains -->
        <VBox spacing="15" styleClass="card">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <FontAwesomeIconView glyphName="CLOCK_ALT" size="20" fill="#2196F3"/>
                <Label text="Rendez-vous Prochains" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
            </HBox>
            
            <Separator/>
            
            <TableView fx:id="tableProchainRdv" prefHeight="300">
                <columns>
                    <TableColumn text="Heure" prefWidth="100" fx:id="colHeure"/>
                    <TableColumn text="Patient" prefWidth="200" fx:id="colPatient"/>
                    <TableColumn text="Médecin" prefWidth="200" fx:id="colMedecin"/>
                    <TableColumn text="Motif" prefWidth="250" fx:id="colMotif"/>
                    <TableColumn text="Statut" prefWidth="120" fx:id="colStatut"/>
                </columns>
            </TableView>
        </VBox>

        <!-- SECTION: Activité Récente -->
        <HBox spacing="20">
            
            <!-- Factures Impayées -->
            <VBox spacing="15" styleClass="card" HBox.hgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <FontAwesomeIconView glyphName="EXCLAMATION_TRIANGLE" size="20" fill="#F44336"/>
                    <Label text="Factures Impayées" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                </HBox>
                
                <Separator/>
                
                <ListView fx:id="listFacturesImpayees" prefHeight="200"/>
            </VBox>

            <!-- Alertes Médicaments -->
            <VBox spacing="15" styleClass="card" HBox.hgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <FontAwesomeIconView glyphName="MEDKIT" size="20" fill="#FF9800"/>
                    <Label text="Alertes Stock" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                </HBox>
                
                <Separator/>
                
                <ListView fx:id="listAlertesMedicaments" prefHeight="200"/>
            </VBox>
        </HBox>

        <!-- Quick Actions -->
        <HBox spacing="15" alignment="CENTER">
            <Button text="Nouveau Patient" styleClass="action-button-success" onAction="#handleAddPatient" prefHeight="45" prefWidth="200">
                <graphic>
                    <FontAwesomeIconView glyphName="USER_PLUS" size="16" fill="WHITE"/>
                </graphic>
            </Button>
            
            <Button text="Nouveau RDV" styleClass="action-button" onAction="#handleAddRendezVous" prefHeight="45" prefWidth="200">
                <graphic>
                    <FontAwesomeIconView glyphName="CALENDAR_PLUS_ALT" size="16" fill="WHITE"/>
                </graphic>
            </Button>
            
            <Button text="Nouvelle Consultation" styleClass="action-button" prefHeight="45" prefWidth="200">
                <graphic>
                    <FontAwesomeIconView glyphName="STETHOSCOPE" size="16" fill="WHITE"/>
                </graphic>
            </Button>
        </HBox>

    </VBox>
</ScrollPane>